"use strict";(()=>{var e={};e.id=230,e.ids=[230],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},96118:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{GET:()=>c,POST:()=>p});var n=s(49303),o=s(88716),a=s(60670),i=s(87070);let u=new(s(53524)).PrismaClient;async function p(e){try{let{businessAccountId:t,accessToken:s,phoneNumberId:r,webhookVerifyToken:n,userId:o}=await e.json();if(!t||!s||!r||!o)return i.NextResponse.json({error:"Faltan datos requeridos para configurar Meta WhatsApp Business"},{status:400});if(!await u.user.findUnique({where:{id:o}}))return i.NextResponse.json({error:"Usuario no encontrado"},{status:404});let a=await u.business.upsert({where:{userId:o},update:{isActive:!0,twilioSid:r,updatedAt:new Date},create:{userId:o,name:"Negocio Meta",category:"retail",whatsappNumber:r,virtualNumber:r,twilioSid:r,address:"",config:{},isActive:!0,createdAt:new Date,updatedAt:new Date}}),p=`${process.env.APP_URL||"https://vendebot.netlify.app"}/api/chatbot/webhook`;return i.NextResponse.json({success:!0,message:"Meta WhatsApp Business configurado correctamente",business:{id:a.id,name:a.name,phoneNumberId:r,isActive:a.isActive},webhookConfig:{url:p,verifyToken:n,fields:["messages","message_deliveries","message_reads"]},nextSteps:["Configura el webhook en Meta for Developers","Prueba enviar un mensaje a tu n\xfamero de WhatsApp Business","Verifica que el bot responda autom\xe1ticamente"]})}catch(e){return console.error("Error configuring Meta WhatsApp Business:",e),i.NextResponse.json({error:"Error interno del servidor"},{status:500})}}async function c(e){try{let{searchParams:t}=e.nextUrl,s=t.get("userId");if(!s)return i.NextResponse.json({error:"ID de usuario requerido"},{status:400});let r=await u.business.findUnique({where:{userId:s},select:{id:!0,name:!0,isActive:!0,createdAt:!0,updatedAt:!0}});if(!r)return i.NextResponse.json({configured:!1,message:"Meta WhatsApp Business no configurado"});return i.NextResponse.json({configured:!0,business:r,webhookUrl:`${process.env.APP_URL||"https://vendebot.netlify.app"}/api/chatbot/webhook`})}catch(e){return console.error("Error getting Meta WhatsApp Business config:",e),i.NextResponse.json({error:"Error interno del servidor"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/business/meta-config/route",pathname:"/api/business/meta-config",filename:"route",bundlePath:"app/api/business/meta-config/route"},resolvedPagePath:"C:\\Users\\CODING\\Documents\\NEWERA\\VENDEBOT\\vendebot\\src\\app\\api\\business\\meta-config\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:f}=d,g="/api/business/meta-config/route";function h(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972],()=>s(96118));module.exports=r})();