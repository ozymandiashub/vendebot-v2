"use strict";(()=>{var e={};e.id=567,e.ids=[567],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},88785:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>u});var a=r(49303),n=r(88716),i=r(60670),o=r(87070);let p=new(r(53524)).PrismaClient;async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("businessId"),s=parseInt(t.get("days")||"7");if(!r)return o.NextResponse.json({error:"Business ID required"},{status:400});let a=new Date;a.setDate(a.getDate()-s);let n=await p.analytics.findMany({where:{businessId:r,timestamp:{gte:a}},orderBy:{timestamp:"desc"}}),i=n.filter(e=>"received"===e.messageType).length,u=n.filter(e=>"sent"===e.messageType).length,l=i>0?u/i*100:0,c=n.filter(e=>e.responseTime&&e.responseTime>0).map(e=>e.responseTime||0),d=c.length>0?c.reduce((e,t)=>e+t,0)/c.length:0,m=n.filter(e=>e.category&&"received"===e.messageType).reduce((e,t)=>{let r=t.category||"other";return e[r]=(e[r]||0)+1,e},{}),g=Object.entries(m).map(([e,t])=>({category:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,5),y=Array.from({length:s},(e,t)=>{let r=new Date;r.setDate(r.getDate()-t);let s=r.toISOString().split("T")[0],a=n.filter(e=>e.timestamp.toISOString().split("T")[0]===s&&"received"===e.messageType).length;return{date:s,messages:a}}).reverse(),h=new Set(n.filter(e=>e.fromNumber&&"received"===e.messageType).map(e=>e.fromNumber)).size;return o.NextResponse.json({success:!0,analytics:{totalMessages:i,automaticResponses:u,responseRate:Math.round(l),averageResponseTime:Math.round(d),uniqueClients:h,topCategories:g,dailyStats:y,period:`${s} d\xedas`}})}catch(e){return console.error("Error fetching analytics:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"C:\\Users\\CODING\\Documents\\NEWERA\\VENDEBOT\\vendebot\\src\\app\\api\\analytics\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=l,g="/api/analytics/route";function y(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(88785));module.exports=s})();